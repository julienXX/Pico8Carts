pico-8 cartridge // http://www.pico-8.com
version 16
__lua__
t=0

function _init()
 titleinit()
end

function titleinit()
 mode=0
 title={sp=7}
end

function gameinit()
 mode=1
 bullets={}
 karim={sp=1,x=40,y=64,w=8,h=8,f=false}
 tachun={sp=3,x=80,y=64,w=8,h=8,f=true}
 flute={sp=16,x=40,y=80}
 coin={sp=5,x=80,y=80}
end

function _update()
 if(mode==0) then
  cls()
  spr(title.sp,48,32,4,4)
  print('karim',20,48,7)
  print('tachun',86,48,7)
  print('press ‚ùé to start',30,80)
  animate()
  startgame()
 else
  cls(3)
  animate()
  move()
  for b in all(bullets) do
   b.x+=b.dx
   b.y+=b.dy
   
   if b.x<0 
      or b.x>128 
      or b.y<0 
      or b.y>128 then
    del(bullets,b)   
   end
  end
 end
end

function _draw()
 if(mode==1) then
  map(1, 1, 16, 16, 112, 112)

  spr(karim.sp,karim.x,karim.y,1,1,karim.f)
  spr(tachun.sp,tachun.x,tachun.y,1,1,tachun.f)
  
  for b in all(bullets) do
   spr(b.sp,b.x,b.y)
  end
 end
end

function animate()
 if(mode==0) then
  animatetitle() 
 else
  animategame() 
 end
end

function animatetitle()
 t+=1
 if(t%8<4) then
  title.sp=7
 else
  title.sp=11
 end
end

function animategame()
 t+=1
 if(t%8<4) then
  karim.sp=1
  tachun.sp=3
 else
  karim.sp=2
  tachun.sp=4
 end
 if(t%3==0) then alternatefire() end
end

function startgame()
 if(btn(5)) then
  sfx(1) 
  gameinit() 
 end
end

function move()
 if(btn(0,0) and karim.x>24) then
  karim.f=true
  karim.x-=1 
 end
 if(btn(1,0) and karim.x<96) then
  karim.f=false
  karim.x+=1
 end
 if(btn(2,0) and karim.y>24) then 
  karim.sp=18
  karim.asp=19
  karim.y -= 1 
 end
 if(btn(3,0) and karim.y<96) then
  karim.sp=18
  karim.asp=19
  karim.y += 1
 end
 if(btn(0,1) and tachun.x>24) then
  tachun.f=true
  tachun.x-=1
 end
 if(btn(1,1) and tachun.x<96) then
  tachun.f=false
  tachun.x += 1
 end
 if(btn(2,1) and tachun.y>24) then
  tachun.sp=20
  tachun.y -= 1
 end
 if(btn(3,1) and tachun.y<96) then
  tachun.sp=20
  tachun.asp=21
  tachun.y += 1
 end
 
 if(btnp(4,0)) then karimfire() end
 if(btnp(4,1)) then tachunfire() end
  
 if(collide(karim,tachun)) then 
  print('lol')
  sfx(0) 
 end
end

function karimfire()
 sfx(2)
 if(karim.f==true) then ldx=-3 else ldx=3 end
 local b={
  from=karim,
  sp=16,
  asp=17,
  x=karim.x,
  y=karim.y,
  dx=ldx,
  dy=0
 }
 add(bullets,b)
end

function tachunfire()
 sfx(3)
 if(tachun.f==true) then ldx=-3 else ldx=3 end
 local b={
  from=tachun,
  sp=5,
  asp=6,
  x=tachun.x,
  y=tachun.y,
  dx=ldx,
  dy=0
 }
 add(bullets,b)
end

function alternatefire()
 for b in all(bullets) do
  local psp=b.sp
  b.sp=b.asp
  b.asp=psp
 end
end

function collide(a, b)
 if a.x+a.w > b.x and
    a.y+a.h > b.y and
    a.x < b.x+b.w and
    a.y < b.y+b.h
 then
  return true
 end
 return false
end

__gfx__
000000000000ff000000ff00000055000000550000aaaa0000999900000000000000000000000000000000000000000000000000000000000000000000000000
000000000003ff000003ff0000085f0000085f000a9999a009777790000000000000000000000000000000000000000000000000000000000000000000000000
0070070000333000003330000088800000888000aa9aa9aa99799799000000000000000000000000000000000000000000000000000000000000000000000000
000770000033f3000033f3f00088f8000088f8f0aa9aa9aa99799799000000000000000000000000000000000000000000000000000000000000000000000000
0007700000ccfff000ccff0000ccfff000ccff00aa99999a997777790000000000000aaaa0000000000000000000000000000aaaa00000000000000000000000
0070070000cccc0000cccc0000cccc0000cccc00aa9aaa9a99799979000000000000aaaaa000000000000000000000000000aaaaa00000000000000000000000
0000000000c00c00000c00c000c00c00000c00c00a9999a009777790000000000000aaaaa00000a000000000000000000000aaaaa00000a00000000000000000
000000000070070000070070007007000007007000aaaa0000999900000000000000aaaaa80aaaaaaa000000000000000000aaaaac0aaaaaaa00000000000000
0000004500000045000ff000000ff000000550000005500000000000000000000000aaaa880aaaaaaaaa0000000000000000aaaacc0aaaaaaaaa000000000000
0000064400000544000ff000000ff00000055000000550000000000000000000000aaaaa80aaa88888aa000000000000000aaaaac0aaacccccaa000000000000
0000544000006440003333000033330000888800008888000000000000000000000aaaa880aa8800088aa00000000000000aaaacc0aacc000ccaa00000000000
00064400000544000f333300003333f00f888800008888f000000000a0000000000aaaa800aa800000888000a0000000000aaaac00aac00000ccc00000000000
005440000064400000ccccf00fcccc0000ccccf00fcccc0000000000a000000000aaaa8800aa880000000000a000000000aaaacc00aacc000000000000000000
064400000544000000cccc0000cccc0000cccc0000cccc0000000000aa00000000aaaa8000aaa88888000000aa00000000aaaac000aaaccccc00000000000000
444000004440000000c00c0000c00c0000c00c0000c00c0000000000aaa000000aaaa880000aaaaaa8800000aaa000000aaaacc0000aaaaaacc0000000000000
04000000040000000070070000700700007007000070070000000000aaa000000aaaa8000000aaaaaaa88000aaa000000aaaac000000aaaaaaacc00000000000
67777777777777767777777770070000dddddddd0000000000000000aaaa00000aaaa800000000aaaaaa8000aaaa00000aaaac00000000aaaaaac00000000000
76000000000000670000000070070000d5ddd5dd0000000000000000aaaaa000aaaa8800000000000aaa8800aaaaa000aaaacc00000000000aaacc0000000000
70600000000006070000000070070000dddddddd00000000000000000aaaa000aaaa800000000000000aa8000aaaa000aaaac00000000000000aac0000000000
70067777777760077777777770070000ddd5dddd000000000000000000aaaa00aaa8800a00000000000aa80000aaaa00aaacc00a00000000000aac0000000000
70076000000670070000000070070000dddddddd0000000000000000000aaa0aaaa8000aa0000000000aa800000aaa0aaaac000aa0000000000aac0000000000
70070600006070070000000070070000ddddddd500000000000000000000aaaaaa8800aaaa0000000aaaa8000000aaaaaacc00aaaa0000000aaaac0000000000
70070060060070070000000070070000dddddddd000000000000000000000aaaa880000aaaaaaaaaaaaa880000000aaaacc0000aaaaaaaaaaaaacc0000000000
70070006600070070000000070070000dd5ddddd000000000000000000000aaa88000000aaaaaaaaaaa8800000000aaacc000000aaaaaaaaaaacc00000000000
7007000660007007000000000000700700000000000000000000000000000088800000000088888888000000000000ccc000000000cccccccc00000000000000
70070060060070070000000000007007000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
70070600006070070000000000007007000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
70076000000670070000000000007007000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
70067777777760077777777700007007000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
70600000000006070000000000007007000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
76000000000000670000000000007007000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
67777777777777767777777700007007000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
__gff__
0001010101000000000000000000000000000101010100000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
0000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
__map__
0000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
0020222222222222222222222100000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
0023242424242424242424243300000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
0023242424242424242424243300000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
0023242424242424242424243300000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
0023242424242424242424243300000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
0023242424242424242424243300000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
0023242424242424242424243300000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
0023242424242424242424243300000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
0023242424242424242424243300000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
0023242424242424242424243300000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
0023242424242424242424243300000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
0030323232323232323232323100000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
__sfx__
00010000094500c4500e4500d4000a400084000640005400064000840008400044000340002400014000140001400014000140003400044000440006400094000d4000f4001040010400114000f4000c4000a400
00100000063500b3501135016350193501e35021350233001b35001300123000e300113001130006300153000e3000e300133001e30013300183001d30021300253002730028300293002a300000002c3002d300
000100003035033350333503335029350213502035000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
000100001e350263502c3502f35032350343503735039350353501f35000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
